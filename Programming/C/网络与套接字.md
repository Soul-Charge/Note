<font style='background:yellow'>还没有整理好</font>  

# 网络与套接字
## 网络程序
网络程序通常由服务器程序和客户端程序组成。  

### 服务器

### 客户端
#### telnet
```
$ telnet 服务器地址 服务器程序运行的端口
// 服务器和客户端运行在同一机器上地址可以使用 127.0.0.1
```

### 协议
服务器与客户端间展开的一段结构化对话。  
协议通常有一套严格的规则，服务器和客户端都需要遵守这些规则，有一方违反了规则对话就会终止。  

#### 低层协议
##### IP(Internet Protocol, 网际协议)
用于控制二进制数据在互联网中的发送方式。  

#### 高层协议
##### HTTP(Hypertext Transfer Protocol, 超文本传输协议)
控制浏览器和网络服务器的对话。  

### 套接字
**头文件**：sys/socket.h
用来与网络通信的数据流。  
套接字是双向的，需要使用特定的函数进行通信。  

#### 使用
```c
int listener_d = socket(PF_INET, SOCK_STREAM, 0);
/*  套接字描述符                              协议号 */
/* 若无法打开套接字，listener_d的值会为-1 */
```

### BLAB—服务器连接网络四步
#### B(Bind, 绑定)——绑定端口
需要套接字描述符和套接字名。  
**头文件**：arpa/inet.h  

##### 套接字名
```c
struct sockaddr_in name(套接字名);
name.sin_family = PF_INET;
name.sin_port = (in_port_t)htons(端口号);
name.sin_addr.s_addr = htonl(INADDR_ANY);
```

##### 绑定
```c
int c = bind(listener_d, (struct sockaddr *) &name, sizeof(name));
/* 无法绑定端口c的值会为-1 */
```
<font color='orange'>这里的变量c好像并不必要，可以直接使用bind()</font>  

#### L(Listen, 监听)——监听
用listen()可以设置队列长度，即有多少客户端可以同时尝试连接服务器，队列外的会被告知服务器太忙。  
```c
listen(listener_d(套接字描述符), 10(队列长度));
/* 失败返回-1 */
```

#### A(Accept, 接受)——接受连接
```c
struct sockaddr_storage client_addr;
unsigned int address_size = sizeof(client_addr);
int connect_d = accept(listener_d, (struct sockaddr *)&client_addr, &address_size);
/* 使用新的套接字描述符(connect_d)来进行通信 */
/* accept() 出错会返回-1 */
```
<font style='background:yellow'>一点要检查系统调用的返回值</font>  

#### B(Begin, 开始)——开始通信
##### send()
```c
char * msg = "xxxxxxx";
send(connect_d, msg, strlen(msg), 0);
/*  套接字描述符  消息  消息长度    高级选项 */
/* 出错返回-1 */
```
























