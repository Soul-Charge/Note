/*! sangforbbs 2020-11-26 */
angular.module("common",[]).config(function($httpProvider){$httpProvider.interceptors.push("httpInterceptor"),$httpProvider.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";var param=function(obj){var name,value,fullSubName,subName,subValue,innerObj,i,query="";for(name in obj)if(value=obj[name],value instanceof Array)for(i=0;i<value.length;++i)subValue=value[i],fullSubName=name+"["+i+"]",innerObj={},innerObj[fullSubName]=subValue,query+=param(innerObj)+"&";else if(value instanceof Object)for(subName in value)subValue=value[subName],fullSubName=name+"["+subName+"]",innerObj={},innerObj[fullSubName]=subValue,query+=param(innerObj)+"&";else void 0!==value&&null!==value&&(query+=encodeURIComponent(name)+"="+encodeURIComponent(value)+"&");return query.length?query.substr(0,query.length-1):query};$httpProvider.defaults.transformRequest=[function(data){return angular.isObject(data)&&"[object File]"!==String(data)?param(data):data}],$httpProvider.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",$httpProvider.defaults.headers.get||($httpProvider.defaults.headers.get={}),$httpProvider.defaults.headers.get["If-Modified-Since"]="Mon, 26 Jul 1997 05:00:00 GMT",$httpProvider.defaults.headers.get["Cache-Control"]="no-cache",$httpProvider.defaults.headers.get.Pragma="no-cache"}).factory("httpInterceptor",function($q){return{response:function(response){var responseData=response.data;return"POST"===response.config.method&&responseData.data&&responseData.data.success===!1&&responseData.message&&showError(responseData.message),response},responseError:function(rejection){return 0===rejection.status&&rejection.config.timeout&&1===rejection.config.timeout.$$state.status?rejection:rejection}}}).service("commonService",function($http,$q,$modal){function fetch(url,option){var canceler=$q.defer(),option=option||{};option.ajaxdata||(option.ajaxdata="json");var promise=$http({method:"post",url:url,data:option,timeout:canceler.promise});return promise.abort=function(){canceler.resolve()},promise}function openModal(templateUrl,size,windowClass,callback,params,submit){$modal.open({animation:!0,backdrop:"static",windowClass:windowClass,size:size||"",templateUrl:templateUrl,controller:function($scope,$modalInstance,$window,data){$scope.data=data,"function"==typeof callback&&callback.apply(this,arguments),$scope.submit=function(option){$scope.isLoading=!0,"function"==typeof submit&&submit(option,function(issuc){$scope.isLoading=!1,"success"===issuc&&$scope.close()})},$scope.close=function(bool){$modalInstance.close(),bool&&window.location.reload()}},resolve:{data:function(){return angular.copy(params)}}})}return{fetch:fetch,openModal:openModal}}).directive("bindHtmlCompile",["$compile",function($compile){return{restrict:"EA",link:function(scope,element){setTimeout(function(){element.html(angular.element(document.querySelector("#compileHtml")).html()),$compile(element.contents())(scope)},500)}}}]),angular.module("ui",["ui.bootstrap","ui.followBtn","ui.avatar","ui.adoptSelect","ui.mobileCodeBtn","ui.comment","ui.sfPager","ui.bindMobileBtn","ui.placeholder","ui.attachment","ui.medal","ui.inputTip","ui.checkboxField","ui.radioField","ui.radioFieldSet","ui.selectField","ui.numberField","ui.searchBar","ui.tabsHover","ui.levelStar","ui.praiseBtn","ui.rewardBtn","ui.samefeelingBtn","ui.vipGroup","ui.creditLevel","ui.onlinePop","ui.dateSelet"]),angular.module("ui.common",["common"]).constant("UI_VIEW_PATH","webapp/common/ui/view").constant("IMAGES_PATH","static/image/sf/common"),angular.module("page",["ui","socket","ngSanitize","page.common"]),angular.module("page.common",["common"]).constant("PAGE_VIEW_PATH","webapp/common/page/view").constant("IMAGES_PATH","static/image/sf/common"),angular.module("page").controller("OpenModalController",function($scope,$rootScope,$modal,commonService){function getCookie(name){var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");return(arr=document.cookie.match(reg))?unescape(arr[2]):null}function setCookie(name,value,time){var strsec=getsec(time),exp=new Date;exp.setTime(exp.getTime()+1*strsec),document.cookie=name+"="+escape(value)+";expires="+exp.toGMTString()}function getsec(str){var str1=1*str.toString().substring(1,str.toString().length),str2=str.toString().substring(0,1);return"s"==str2?1e3*str1:"h"==str2?60*str1*60*1e3:"d"==str2?24*str1*60*60*1e3:void 0}function getRemainMs(){var date=new Date,hour=23-date.getHours(),min=59-date.getMinutes(),second=59-date.getSeconds(),ms=3600*hour+60*min+second;return ms}function openModal(windowClass,templateUrl,callback,size){return isRequesing?!1:(isRequesing=!0,void $modal.open({animation:!0,size:size,windowClass:windowClass,templateUrl:templateUrl,backdrop:"static",controller:function($scope,$modalInstance,$window){isRequesing=!1,"function"==typeof callback&&(callback($scope),callback.apply(this)),$scope.close=function(){$modalInstance.close()},$scope.ajaxpost=function(formid,showid,waitid,showidclass,submitbtn,recall,md5){md5&&pwmd5(md5),pwdclear=1,ajaxpost(formid,showid,waitid,showidclass,submitbtn,recall)},$scope.loginSuccess=function(data){"string"==typeof data&&data.indexOf("succeed")>0&&data.indexOf("error")<0&&$modalInstance.close()}}}))}$scope.closeUpgrade=!1,$scope.closedaylogin=!1,$scope.flauntXc=!0,$scope.issueXc=!0,$scope.changedaylogin=function(bool){$scope.closedaylogin=bool};var isRequesing=!1;$rootScope.openQuicklogin=function(e,sf_location,sf_click_id){if(window.event.preventDefault(),!(discuz_uid>0)){iswxlogin();var templateUrl="member.php?mod=logging&action=login&handlekey=post&infloat=yes&inajax=yes&guestmessage=yes";null!=sf_location&&""!=sf_location&&(templateUrl+="&sf_location=1&referer="+encodeURIComponent(sf_location)),null!=sf_click_id&&""!=sf_click_id&&(templateUrl+="&sf_click_id="+sf_click_id),openModal("fastLogin",templateUrl,function(childscope){childscope&&!childscope.formData&&(childscope.formData={logintypebycode:!1})})}},$rootScope.click_login=function(bool){bool&&jQuery("#phonelogin").val(jQuery(".username_loginhash_new").val())},newopenQuicklogin=function(){var e=window.event;if(console.log(window),e.preventDefault(),!(discuz_uid>0)){var templateUrl="member.php?mod=logging&action=login&handlekey=post&infloat=yes&inajax=yes&guestmessage=yes";templateUrl+="&sf_location=1&referer="+encodeURIComponent("forum.php?mod=post&action=newthread&typeid=11"),openModal("fastLogin",templateUrl,function(childscope){childscope&&!childscope.formData&&(childscope.formData={logintypebycode:!1})})}},$rootScope.close_cookie=function(){jQuery(".join-tip-wrap").addClass("hide"),getCookie("loginTip")||setCookie("loginTip",+new Date,getRemainMs())},getCookie("loginTip")&&setTimeout(function(){jQuery(".join-tip-wrap").addClass("hide")},500),$scope.openQuickPost=function(typeid,product,sf_location,sf_click_id){var templateUrl,fastLogin;discuz_uid>0?templateUrl="forum.php?mod=post&action=newthread&infloat=yes&handlekey=post&inajax=1&ajaxtarget=fwin_content_post&ajaxdata=html&typeid="+typeid:(templateUrl="member.php?mod=logging&action=login&handlekey=post&infloat=yes&inajax=yes&guestmessage=yes",fastLogin="fastLogin",null!=sf_location&&""!=sf_location&&(templateUrl+="&sf_location=1&referer="+encodeURIComponent(sf_location)),null!=sf_click_id&&""!=sf_click_id&&(templateUrl+="&sf_click_id="+sf_click_id)),"undefined"!=typeof product&&""!=product&&(templateUrl+="&from_type=dev&product="+product),"undefined"!=typeof $scope.close&&$scope.close(),openModal(fastLogin,templateUrl,function(){$scope.typeid=typeid})},$scope.openModalFun=function(templateUrl,size,windowClass,callback,update){if(update){var timestamp=(new Date).getTime();templateUrl=templateUrl+"&v="+timestamp}openModal(windowClass,templateUrl,callback,size)},$scope.blobStatus=function(status){return 1&status?!1:1},$scope.showGuideTip=function(name){return loadUserdata(name)===today?!1:!0},"undefined"!=typeof showOnlineModal&&"show"===showOnlineModal&&(discuz_uid>0?(templateUrl="sf.php?mod=online&op=modal",openModal("",templateUrl,"","md")):(templateUrl="member.php?mod=logging&action=login&handlekey=post&infloat=yes&inajax=yes&guestmessage=yes&sf_click_id=questionBtn",openModal("fastLogin",templateUrl))),$scope.is_close=function(){angular.element(".upgradeShade").css("display","none"),$scope.closeUpgrade=!0,window.location.reload()},$scope.is_flaunt=function(){$scope.flauntXc=!1,$scope.closeUpgrade=!0,angular.element(".It-baoguo2").css("display","block")},$scope.flauntxc=function(){$scope.flauntXc=!0,angular.element(".It-baoguo2").css("display","none"),window.location.reload()},$scope.flaunt_fb=function(){if(1==$scope.issueXc){$scope.issueXc=!1;var url="plugin.php?id=growth:addjoin&action=is_upgrade",text=$scope.introduce;if(null==text)return!1;commonService.fetch(url,{text:text}).then(function(respond){1==respond.data.code&&(window.location.href="/plugin.php?id=index:index")})}},$scope.onlyConfirmChannel=function(){url="sf.php?mod=home&op=confirmmobile",commonService.fetch(url).success(function(respone){respone.success?"channel"===respone.confirm?(showError("认证成功"),setTimeout(function(){window.location.reload()},2e3)):showError("手机号未识别，请确认已录入系统"):showError(respone.message,1)})}}),angular.module("page").controller("OpengcsController",function($scope,$rootScope,$modal){function openModal(windowClass,templateUrl,callback){$modal.open({animation:!0,backdrop:"static",windowClass:windowClass,templateUrl:templateUrl,controller:function($scope,$modalInstance,$window){"function"==typeof callback&&callback.apply(this),$scope.close=function(){$modalInstance.close()}}})}var templateUrl="gcsSign.html";openModal("fastLogin",templateUrl)}),angular.module("page").controller("VideoCarouselController",function($scope){$scope.videoInterval=5e3,$scope.playingVideoCount=0,setTimeout(function(){angular.element("div[carousel] video").on("playing",function(){$scope.playingVideoCount++}),angular.element("div[carousel] video").on("pause",function(){$scope.playingVideoCount&&$scope.playingVideoCount--})},0),$scope.$watch("playingVideoCount",function(val){val>0?$scope.videoInterval=0:$scope.videoInterval=5e3})}),angular.module("page").controller("adDialogController",function($scope,$timeout){var countDownTimeout=null,closeT=6e4,_ad=angular.element(".ad-dialog");countDownTimeout=$timeout(function(){_ad.removeClass("ad-dialog-out").addClass("ad-dialog-in")},closeT),$scope.closeAdDialog=function(){_ad.removeClass("ad-dialog-out").addClass("ad-dialog-in"),countDownTimeout&&$timeout.cancel(countDownTimeout)}}).controller("adDialogRobotCtrl",function($scope,$timeout,commonService){var countDownTimeout=null,_ad=angular.element(".ad-dialog-robot"),date=new Date,nowDate=date.getMonth()+""+date.getDate(),openDate=loadUserdata("adRobot");openDate!==nowDate&&"undefined"!=typeof isOpenadDialogRobotCtrl&&(countDownTimeout=$timeout(function(){_ad.addClass("ad-dialog-robot-out"),saveUserdata("adRobot",nowDate);var image=angular.element("#dialogImg")[0];image.stop(),image.play(),$timeout(function(){_ad.removeClass("ad-dialog-robot-out").addClass("ad-dialog-robot-in"),_ad.find(".tip").removeClass("slideOut")},13e3)},2e3),_ad.hover(function(){_ad.removeClass("ad-dialog-robot-out").addClass("ad-dialog-robot-in"),_ad.find(".tip").removeClass("slideOut")})),$scope.closeEver=function(){var isclose=$scope.isclose?1:0,url="sf.php?mod=home&op=closeAdRobot&isclose="+isclose;commonService.fetch(url)}}),"getContext"in document.createElement("canvas")&&(HTMLImageElement.prototype.play=function(){this.storeCanvas&&(this.storeCanvas.parentElement.removeChild(this.storeCanvas),this.storeCanvas=null,image.style.opacity=""),this.storeUrl&&(this.src=this.storeUrl)},HTMLImageElement.prototype.stop=function(){var canvas=document.createElement("canvas"),width=this.width,height=this.height;if(width&&height){this.storeUrl||(this.storeUrl=this.src),canvas.width=width,canvas.height=height,canvas.getContext("2d").drawImage(this,0,0,width,height);try{this.src=canvas.toDataURL("image/gif")}catch(e){this.removeAttribute("src"),canvas.style.position="absolute",this.parentElement.insertBefore(canvas,this),this.style.opacity="0",this.storeCanvas=canvas}}}),angular.module("page").controller("commonCouponController",function($scope,$timeout,commonService){var apiUrl="sf.php?mod=coupon";$scope.getCoupon=function(id,e){commonService.fetch(apiUrl,{action:"getCoupon",id:id}).success(function(res){1==res.status&&jQuery(e.target).parent().html('<span class="status gray">已领取</span>'),showDialog(res.msg,"notice")})}}),angular.module("page").controller("onlineInController",function($scope,commonService){$scope.toggleNote=function(e){if(!$scope.disabledNote){var isMemberNote=$scope.isMemberNote?0:1;commonService.fetch("sf.php?mod=sobot&action=online_activity_note",{isMemberNote:isMemberNote}).then(function(res){1==res.data.status&&($scope.isMemberNote=!$scope.isMemberNote)})}}}),angular.module("page").controller("postPowerController",function($scope,$modal,PAGE_VIEW_PATH,commonService){$scope.openPostPower=function(){var templateUrl;discuz_uid>0?(templateUrl=PAGE_VIEW_PATH+"/postPower.html?v="+VERHASH,commonService.openModal(templateUrl,"","def")):(templateUrl="member.php?mod=logging&action=login&handlekey=post&infloat=yes&inajax=yes&guestmessage=yes&sf_click_id=questionBtn",commonService.openModal(templateUrl,"","fastLogin"))},$scope.openPowerConfirm=function(){"undefined"!=typeof $scope.close&&$scope.close();var url="sf.php?mod=api&action=powerconfirm";commonService.openModal(url)}}),angular.module("page").controller("pageCommonController",function($scope,commonService,$timeout,$location){var _status,_formData;_status=$scope.status={isRequesting:!1,isLoading:!1},_formData=$scope.formData={phone:""},$scope.bindMobile=function(confirm){var url="home.php?mod=misc&ac=emailcheck&action=modify&handlekey=mobile",code=angular.element('input[name="code"]').val(),formhash=angular.element('input[name="formhash"]').val(),hashid=angular.element("#hashid").val(),test=/^1[23456789]\d{9}$/;return"undefined"==typeof _formData.phone||""===_formData.phone?void showError("请输入您的手机号码"):test.test(_formData.phone)?"undefined"==typeof hashid||""===hashid?void showError("请先获取验证码"):"undefined"==typeof code||""===code?void showError("请输入验证码"):void(_status.isRequesting||(_status.isRequesting=!0,_status.isLoading=!0,commonService.fetch(url,{phone:_formData.phone,formhash:formhash,code:code}).success(function(respone){var msg="";if(_status.isRequesting=!1,_status.isLoading=!1,respone.data.confirm===confirm&&respone.data.success)msg="恭喜您通过身份认证";else{if("channel"===confirm&&"member"===respone.data.confirm)return void($scope.confirmChannel=2);msg="employee"===respone.data.confirm?"该手机号码已成功认证为员工组":respone.message}showError(msg,1.5),respone.data.success&&$timeout(function(){window.location.reload()},1e3)}))):void showError("请输入正确的手机号码")},$scope.channelFeedback=function(){var company=angular.element('input[name="fb_company"]').val(),url="forum.php?mod=op&ac=feedback&company="+company;return"undefined"==typeof company||""===company?void showError("请输入您的公司"):void(_status.isRequesting||(_status.isRequesting=!0,_status.isLoading=!0,commonService.fetch(url).success(function(respone){showError(respone.message,1),$timeout(function(){angular.element("#identificationUrl")&&angular.element("#identificationUrl").val()?window.location.href=angular.element("#identificationUrl").val():window.location.reload()},500),_status.isRequesting=!1,_status.isLoading=!1})))},$scope.firstConfirm=function(type){$scope.confirm=type},$scope.bindDevIdentify=function(click){var patrn=/^[A-Za-z0-9]{8,32}$/,url="sf.php?mod=home&op=devidentify",data={num:angular.element('input[name="devIdentify"]').val().replace(/^\s\s*/,"").replace(/\s\s*$/,""),click:click||"",hash:angular.element('input[name="hashdev"]').val()};return""===data.num||void 0===data.num?void showError("请输入SN码或网关ID",1):patrn.test(data.num)?void(_status.isRequesting||(_status.isRequesting=!0,_status.isLoading=!0,commonService.fetch(url,data).success(function(respone){respone.message?showError(respone.message,1):showError("认证成功",1),_status.isRequesting=!1,_status.isLoading=!1,"vip"===respone.confirm&&(angular.element("#identificationUrl")&&angular.element("#identificationUrl").val()?window.location.href=angular.element("#identificationUrl").val():angular.element("#firstConfirmModal").hide())}))):void showError("只能输入8-32位的数字和字母",1)},$scope.clickStat=function(status,click,reload,name){var url=encodeURI("sf.php?mod=api&action=clickcount&status="+status+"&clickname="+click+"&option="+name);commonService.fetch(url),reload&&window.location.reload()},$scope.addressSubmit=function(){if(_status.isRequesting)return!1;var data=angular.element("form#address").serialize(),url="sf.php?mod=api&action=addressadd&"+data;_status.isRequesting=!0,_status.isLoading=!0,commonService.fetch(url).success(function(respone){_status.isRequesting=!1,_status.isLoading=!1,respone.message&&showError(respone.message),respone.data.success&&("boolean"==typeof respone.data.reload?window.location.reload():"string"==typeof respone.data.reload&&$location.url(respone.data.reload),$scope.close())})},$scope.fillAddress=function(type,id,isedit,e){"undefined"!=typeof $scope.close&&$scope.close(),e&&!type&&e.target.attributes.type&&(type=e.target.attributes.type.value),e&&!id&&e.target.attributes.aid&&(id=e.target.attributes.aid.value),e&&!isedit&&e.target.attributes.isedit&&(isedit=e.target.attributes.isedit.value);var url="sf.php?mod=api&action=addresstemp&type="+type+"&id="+id+"&isedit="+isedit;commonService.openModal(url,"md")},$scope.vipLoginReward=function(){if(_status.isRequesting)return!1;var url="home.php?mod=spacecp&ac=vip&op=reward&submit=1";_status.isRequesting=!0,_status.isLoading=!0,commonService.fetch(url).success(function(respone){_status.isRequesting=!1,_status.isLoading=!1,respone.message&&showError(respone.message),respone.data&&respone.data.success&&($timeout(function(){$scope.close()},1e3),respone.data.iszombies&&$scope.fillAddress("zombies",respone.data.zombies_id))})}}).controller("signModalCtrl",function($scope,$modal,commonService){var _data,calendersData=window.calendersData,member=window.member;_data=$scope.data={calenders:calendersData.calender,monthlist:calendersData.month,month:calendersData.month[0],currentMonth:calendersData.month[0],mLength:calendersData.month.length,monthCount:calendersData.count,supplecheck:member.supplecheck,showtab:0,day:"",monthday:""},$scope.setmonth=function(select){var index=_data.monthlist.indexOf(_data.month);1===select?index<_data.mLength-1?_data.month=_data.monthlist[index+1]:_data.month=_data.monthlist[0]:0===select&&(index>0?_data.month=_data.monthlist[index-1]:_data.month=_data.monthlist[_data.mLength-1]);var url="plugin.php?id=sign:index",option={date:_data.month,op:"calender"};commonService.fetch(url,option).then(function(respond){_data.calenders=respond.data.calender,_data.monthCount=respond.data.count})},$scope.toggleNote=function(e){if(!$scope.disabledNote){var isMemberNote=$scope.isMemberNote?0:1;commonService.fetch("plugin.php?id=sign:index&op=note",{isMemberNote:isMemberNote}).then(function(res){1==res.data.status&&($scope.isMemberNote=!$scope.isMemberNote)})}},$scope.supple=function(monthday,day){$scope.data.monthday=monthday,$scope.data.day=day,$scope.data.monthday==$scope.data.currentMonth&&$scope.data.supplecheck.supple>0&&(angular.element("#replacement_tips").css("display","block"),angular.element("#mask").css("display","block"))},$scope.submit_supplement=function(){var url="plugin.php?id=sign:index&op=supplecheck&month="+_data.monthday+"&day="+_data.day;commonService.fetch(url).then(function(respond){1==respond.data.success?(alert(respond.data.msg),window.location.href="plugin.php?id=info:index"):alert(respond.data.msg)});angular.element("#replacement_tips").css("display","none"),angular.element("#mask").css("display","none")},$scope.cancel_supplement=function(){angular.element("#replacement_tips").css("display","none"),angular.element("#mask").css("display","none")}}).directive("bindHtmlCompile",["$compile",function($compile){return{restrict:"EA",link:function(scope,element){scope.$watch(function(){return angular.element(document.querySelector("#bindHtmlCompile")).html()},function(value){element.html(value),$compile(element.contents())(scope)})}}}]),angular.module("page").controller("signBtnController",function($scope,commonService){var isRequesting=!1;$scope.sign=function(isSign){if(isRequesting)return!1;if(isSign||1==$scope.data.signInfo.has_sign)return commonService.openModal("plugin.php?id=sign:index&op=share&noload=1","lg"),!1;isRequesting=!0,$scope.isSignLoading=!0;var url="plugin.php?id=sign:index&op=sign",options={hash:angular.element('input[name="signhash"]').val()};commonService.fetch(url,options).then(function(respond){$scope.isSignLoading=!1,isRequesting=!1,respond.data.success?($scope.data.signInfo=respond.data.sign_info,commonService.openModal("plugin.php?id=sign:index&op=share&noload=1&sbean="+respond.data.sbean,"lg")):(showError(respond.data.msg),respond.data.hassign&&(window.location="plugin.php?id=sign:index"))})}}),angular.module("page").controller("spaceUserController",function($scope,$location,$http){var _data=$scope.data={oldBio:"",newBio:"",formhash:"",loading:!1,isShowEditBio:!1};$scope.editBio=function(){if(_data.loading||_data.oldBio==_data.newBio)return _data.oldBio==_data.newBio&&(_data.isShowEditBio=!1),!1;_data.loading=!0;var editBioUrl="home.php?mod=spacecp&ac=profile&op=base&inajax=1&profilesubmit=true";$http.post(editBioUrl,{bio:_data.newBio,ajaxdata:"json",formhash:_data.formhash}).then(function(res){res&&res.data&&res.data.success?(_data.oldBio=_data.newBio,_data.isShowEditBio=!1):res&&res.data&&res.data.msg?showError(res.data.msg):showError("网络错误，请重试！"),_data.loading=!1})}}),angular.module("page").directive("rolling",function($interval,$timeout){return{restrict:"EA",scope:{timeout:"@",height:"=?"},link:function(scope,element,attrs){var subElement=element.find(">*"),subHeight=0,subLength=subElement.length,height=element.height(),timeout=scope.timeout||3e3,interval=null,foriTop=[];if(subElement.each(function(index,elem){var ngElem=angular.element(elem),iH=parseInt(ngElem.height())+(parseInt(ngElem.css("paddingTop"))||0)+(parseInt(ngElem.css("paddingBottom"))||0)+(parseInt(ngElem.css("borderTopWidth"))||0)+(parseInt(ngElem.css("borderBottomWidth"))||0);iH=scope.height?scope.height:iH,foriTop[index]=iH,subHeight+=iH}),!(height>subHeight)){var cloneItem=subElement.clone(),iTop=0,forLength=0,firstItem=subElement.filter(":first");element.append(cloneItem);var rolling=function(){interval=$interval(function(){iTop-=foriTop[forLength],forLength++,forLength===subLength&&(element.append(cloneItem.clone()),forLength=0),firstItem.animate({marginTop:iTop},"slow")},timeout)};rolling(),element.mouseenter(function(){$interval.cancel(interval)}).mouseleave(function(){rolling()})}}}}),angular.module("page").directive("dayLogin",["PAGE_VIEW_PATH",function(PAGE_VIEW_PATH){return{restrict:"EA",replace:!0,templateUrl:"home.php?mod=spacecp&ac=ordinary&op=reward&isclick="+window.isShowDay,controller:"OrdinaryRewardController",scope:{closedaylogin:"=?",changedaylogin:"=?"}}}]).controller("OrdinaryRewardController",["$scope","$timeout","commonService",function($scope,$timeout,commonService){window.isShowDay&&window.ordinaryLoginReward?$scope.closedaylogin=!0:$scope.closedaylogin=!1;var _data=$scope.data={isget:0};$timeout(function(){$scope.dayloginMsg&&$scope.dayloginMsg[1]&&(_data.isget=$scope.dayloginMsg[1].isget?$scope.dayloginMsg[1].isget:0)},20),jQuery(".daylogin-shade").css("opacity",0);var maxNum;$scope.$watch("closedaylogin",function(value){if(!value&&!maxNum)var timer=setInterval(function(){jQuery(".details").length&&(jQuery.each(jQuery(".details"),function(index,item){0==index?maxNum=jQuery(item).height():maxNum<jQuery(item).height()&&(maxNum=jQuery(item).height())}),jQuery(".daylogin .login_package .daylogin_alert .daylogin_bottom .daylogin_time").height(maxNum+5),jQuery(".daylogin-shade").css("opacity",1),clearInterval(timer))},1)}),$scope.getReward=function(){var url="home.php?mod=spacecp&ac=ordinary&op=reward&submit=1";commonService.fetch(url).then(function(res){_data.isget=1,res.data.ret&&1==res.data.ret.success&&($scope.data.isget=res.data.ret.isget,res.data.ret.iszombies?$scope.fillAddress("zombies",res.data.ret.zombies_id):window.location.reload())})},$scope.fillAddress=function(type,id,isedit,e){"undefined"!=typeof $scope.close&&$scope.close(),e&&!type&&e.target.attributes.type&&(type=e.target.attributes.type.value),e&&!id&&e.target.attributes.aid&&(id=e.target.attributes.aid.value),e&&!isedit&&e.target.attributes.isedit&&(isedit=e.target.attributes.isedit.value);var url="sf.php?mod=api&action=addresstemp&type="+type+"&id="+id+"&isedit="+isedit;commonService.openModal(url,"md")},$scope.closeAlert=function(){$scope.changedaylogin?$scope.changedaylogin(!0):$scope.closedaylogin=!$scope.closedaylogin}}]),angular.module("page").directive("dynamicModule",["PAGE_VIEW_PATH",function(PAGE_VIEW_PATH){return{restrict:"EA",replace:!0,templateUrl:function(elem,attrs){return attrs.module=attrs.module?attrs.module:"","/sf.php?mod=dynamic_module&module="+attrs.module+"&action="+attrs.action},controller:"dynamicModuleController",scope:!0}}]).controller("dynamicModuleController",["$scope","$rootScope","$timeout","$element","$document",function($scope,$rootScope,$timeout,$element,$document){discuz_uid>0&&($rootScope.discuz_uid=discuz_uid)}]),angular.module("page").directive("fixedScroll",["$timeout",function($timeout){return{restrict:"A",replace:!1,link:function(scope,$elem){var top=angular.element("#fixed_scroll").offset().top;angular.element(document).on("scroll",function(){var iScroll=document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop;iScroll>top?$elem.addClass("fixed-side"):$elem.removeClass("fixed-side")})}}}]),angular.module("page").directive("globalSearch",["PAGE_VIEW_PATH",function(PAGE_VIEW_PATH){return{restrict:"A",replace:!0,templateUrl:PAGE_VIEW_PATH+"/globalSearch.html?v="+VERHASH,controller:"GlobalSearchController",scope:{active:"=?"}}}]).controller("GlobalSearchController",["$scope","$timeout","$element","$document","globalSearchBarService",function($scope,$timeout,$element,$document,globalSearchBarService){var searchKeyPressTimeout=null,searchHttpPromise=null;$scope.active=!1,$scope.hotactive=!1,$scope.placeholder="搜索",$scope.searchLoading=!1,$scope.showSearchMenu=!1,$scope.searchBlur=!1,$scope.data={},$scope.initdata={},globalSearchBarService.getInitData().success(function(res){res.success&&(res.data.holSearchData.length>10?res.data.holSearchData.length=10:res.data.holSearchData,$scope.initdata.holSearchData=res.data.holSearchData,$scope.initdata.searchHistory=res.data.searchHistory)}),$scope.readOnlyBool=!0,$scope.focusSearch=function(){$scope.readOnlyBool=!1,$scope.placeholder="",$scope.searchBlur=!0,$scope.active=!0,$scope.hotactive=!0,$scope.searchWidthStyle={width:"400px"},$scope.query&&$scope.query.length&&$scope.keyPressSearch()},$scope.blurSearch=function(){$scope.readOnlyBool=!0,$timeout(function(){$scope.searchBlur&&($scope.searchWidthStyle={},$scope.showSearchMenu=!1,$scope.searchLoading=!1,$scope.hotactive=!1,$timeout(function(){$scope.active=!1},400))},0)},$scope.searchHistoryItem=function(keyword){window.open("search.php?mod=index#/comprehensiveness/all/all/1/all/all/0/dateline/1/"+keyword)},$scope.deleteSearchHistory=function(e,key,type){e.preventDefault(),e.stopPropagation(),globalSearchBarService.deleteSearchHistory(key,type).success(function(res){res.success&&($scope.initdata.searchHistory=res.data)})},$scope.keyPressSearch=function($event,allsearch){return searchKeyPressTimeout&&$timeout.cancel(searchKeyPressTimeout),$event&&13===$event.which||allsearch?($scope.query="undefined"==typeof $scope.query?"":$scope.query,void($scope.query&&window.open("search.php?mod=index#/comprehensiveness/all/all/1/all/all/0/dateline/1/"+$scope.query))):$scope.query?void(searchKeyPressTimeout=$timeout(function(){return $scope.query?($scope.searchLoading=!0,searchHttpPromise&&searchHttpPromise.abort(),searchHttpPromise=globalSearchBarService.search($scope.query),void searchHttpPromise.success(function(response){if($scope.searchLoading=!1,$scope.active&&($scope.showSearchMenu=!0),!$scope.query)return $scope.showSearchMenu=!1,!1;var responseData=response&&response.data;responseData&&responseData.success?($scope.data.specialData=responseData.specialData,$scope.data.databaseData=responseData.databaseData,$scope.data.threadData=responseData.threadData,$scope.data.productData=responseData.productData,$scope.data.userData=responseData.userData,$scope.hasProductData=responseData.productData&&null!==responseData.productData&&"object"==typeof responseData.productData&&"undefined"==typeof responseData.productData.length,$scope.hasData=responseData.specialData&&responseData.specialData.length||responseData.databaseData&&responseData.databaseData.length||responseData.threadData&&responseData.threadData.length||$scope.hasProductData||responseData.userData&&responseData.userData.length,responseData.searchHistory&&($scope.initdata.searchHistory=responseData.searchHistory)):($scope.data={},$scope.hasData=!1)})):($scope.data={},$scope.hasData=!1,$scope.showSearchMenu=!1,!1)},300)):($scope.showSearchMenu=!1,!1)},$scope.mouseEnterSearchMenu=function(){$scope.searchBlur=!1},$document.on("click",function(e){0===$element.find(e.target).length&&(searchKeyPressTimeout&&$timeout.cancel(searchKeyPressTimeout),$scope.placeholder="搜索",$scope.searchBlur=!0,$scope.blurSearch())})}]).factory("globalSearchBarService",["$http","$q",function($http,$q){var promise=null;return{search:function(key){var canceler=$q.defer();return promise=$http({method:"post",url:"sf.php?mod=search",timeout:canceler.promise,data:{query:key,record:!0,action:"simple",type:"simple"}}),promise.abort=function(){canceler.resolve()},promise},getInitData:function(){var canceler=$q.defer();return promise=$http({method:"post",url:"sf.php?mod=search",timeout:canceler.promise,data:{action:"getSearchInit"}}),promise.abort=function(){canceler.resolve()},promise},deleteSearchHistory:function(key,type){var canceler=$q.defer();return promise=$http({method:"post",url:"sf.php?mod=search",timeout:canceler.promise,data:{action:"deleteSearchHistory",query:key,type:type}}),promise.abort=function(){canceler.resolve()},promise}}}]),angular.module("page").directive("topBar",["$timeout",function($timeout){return{restrict:"A",replace:!1,controller:"TopBarController",link:function(scope,$elem,attrs){$timeout(function(){angular.element("#scbar_txt").change()}),angular.element(document).on("scroll",function(){var iScroll=document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop;iScroll>0?$elem.addClass("filterbar"):$elem.removeClass("filterbar")})}}}]).controller("TopBarController",["$scope","$location",function($scope,$location){var _state=$scope.state={query:$location.search().query||""};$scope.search=function(){var inSearchPage=location.pathname.indexOf("search.php")>=0,query=_state.query||"";return"string"==typeof query&&0===query.length?!1:void(inSearchPage?$location.search("query",query):location.href="search.php?mod=index#?query="+query)},$scope.toggleDropdown=function(status){$scope.status=status},$scope.postDropdown=function(poststatus){$scope.poststatus=poststatus},$scope.$root.$on("_updateQuery",function(e,query){_state.query=query})}]),angular.module("page").filter("prettyDate",function(){return function(time){var date=new Date((time||"").replace(/-/g,"/").replace(/[TZ]/g," ")),diff=((new Date).getTime()-date.getTime())/1e3,day_diff=Math.floor(diff/86400);if(!(isNaN(day_diff)||0>day_diff||day_diff>=31))return 0==day_diff&&(60>diff&&"just now"||120>diff&&"1 minute ago"||3600>diff&&Math.floor(diff/60)+" minutes ago"||7200>diff&&"1 hour ago"||86400>diff&&Math.floor(diff/3600)+" hours ago")||1==day_diff&&"Yesterday"||7>day_diff&&day_diff+" days ago"||31>day_diff&&Math.ceil(day_diff/7)+" weeks ago";
}}),angular.module("page").filter("size",function(){return function(obj){var size;return angular.isArray(obj)?size=obj.length:angular.isObject(obj)&&(size=0,angular.forEach(obj,function(){size+=1})),size}}),angular.module("page").filter("trust",["$sce",function($sce){return function(text){return $sce.trustAsHtml(text)}}]),angular.module("page").service("ThreadService",function($http,$q){function fetch(option){var canceler=$q.defer(),promise=$http({method:"POST",url:"sf.php?mod=fetchthread&ajaxdata=json",timeout:15e3,data:{orderby:option.orderby,digest:option.digest,special:option.special,ffriend:option.ffriend,fid:option.fid,typeid:option.typeid,page:option.page,agree:option.agree,pager:option.pager}});return promise.abort=function(){canceler.resolve()},promise}function sharefetch(option){var canceler=$q.defer(),promise=$http({method:"POST",url:"sf.php?mod=sharefetch&ajaxdata=json",timeout:15e3,data:{orderby:option.orderby,digest:option.digest,generic:option.generic,special:option.special,ffriend:option.ffriend,fid:option.fid,typeid:option.typeid,page:option.page,agree:option.agree,pager:option.pager}});return promise.abort=function(){canceler.resolve()},promise}function infofetch(option){var canceler=$q.defer(),promise=$http({method:"POST",url:"sf.php?mod=infothread&type=thread&ajaxdata=json",timeout:15e3,data:{orderby:option.orderby,digest:option.digest,generic:option.generic,special:option.special,ffriend:option.ffriend,fid:option.fid,typeid:option.typeid,page:option.page,agree:option.agree,pager:option.pager,init:option.init}});return promise.abort=function(){canceler.resolve()},promise}return{fetch:fetch,sharefetch:sharefetch,infofetch:infofetch}}),angular.module("page").factory("commentService",function($http,formhash){function fetch(option){return option=angular.extend({pid:null,url:MOD_PATH},option),$http({method:"GET",url:option.url,params:option})}function reply(option,url){return option=angular.extend({url:url||MOD_PATH,tid:null,formhash:formhash,message:null,usesig:1,reppid:null,ajaxdata:"json"},option),$http({method:"POST",url:option.url,data:option})}function fetchNoticeInfo(url){return $http.get(url)}var MOD_PATH="sf.php?mod=comment&ajaxdata=json";return{fetch:fetch,reply:reply,fetchNoticeInfo:fetchNoticeInfo}}),angular.module("page").factory("utilService",function(){return{prettyDate:function(time){var diff=((new Date).getTime()-time)/1e3,day_diff=Math.floor(diff/86400);if(!(isNaN(day_diff)||0>day_diff||day_diff>=31))return 0==day_diff&&(60>diff&&"刚刚"||120>diff&&"1分钟前"||3600>diff&&Math.floor(diff/60)+"分钟前"||7200>diff&&"1 hour ago"||86400>diff&&Math.floor(diff/3600)+"小时前")||1==day_diff&&"昨天"||7>day_diff&&day_diff+"天前"||31>day_diff&&Math.ceil(day_diff/7)+"周前"},formatDate:function(time){var date=new Date(time);return date.getYear()+"-"+date.getMonth()+"-"+date.getDay()+" "+date.getHours()+":"+date.getMinutes()}}}),angular.module("socket",[]).controller("messageController",function($scope,messageService){$scope.count=0,messageService.init($scope.count,function(data){$scope.type=data.type||"total",$scope.count=data.count||0,$scope.$apply()})}).factory("messageService",function(socketService){return{init:function(initValue,fn){var socket=socketService.getSocketObj();socket.on("connect",function(data){socket.emit("update",{uid:discuz_uid||0,initTotalValue:initValue})}).on("updateNewPrompt",function(data){fn(data)})}}}).factory("socketService",function($location){if("bbs2.sangfor.com.cn"==document.location.hostname)var socket=io("https://wss2.sangfor.com.cn:8890");else var socket=io("https://wss.sangfor.com.cn:8890");return{getSocketObj:function(){return socket}}}),angular.module("ui.adoptSelect",["ui.common"]).directive("adoptSelect",function(UI_VIEW_PATH){return{restrict:"EA",templateUrl:UI_VIEW_PATH+"/adoptSelect.html?v="+VERHASH,replace:!0,controller:"adoptSelectController",link:function(scope,element,attrs){scope.allowadmin=parseInt(attrs.groupid),scope.type=attrs.type||"thread",scope.statusid=parseInt(attrs.statusid)||0,scope.tid=attrs.tid||0,scope.pid=attrs.pid||0,scope.replyid=parseInt(attrs.replyid)||0,scope.agree=parseInt(attrs.agree)||0,"thread"==scope.type?scope.items=[{name:"初级采纳奖励",value:2},{name:"中级采纳奖励",value:3},{name:"高级采纳奖励",value:4},{name:"已有规划",value:5},{name:"已实现",value:6},{name:"不采纳",value:18}]:"databases"==scope.type?scope.items=[{name:"初级反馈奖励",value:8},{name:"中级反馈奖励",value:16},{name:"高级反馈奖励",value:17},{name:"已答复",value:9},{name:"已完善",value:10}]:"share"==scope.type?scope.items=[{name:"有料",value:11},{name:"优秀",value:12},{name:"版主推荐",value:13},{name:"精华",value:20},{name:"无评级",value:19}]:"question"==scope.type?scope.items=[{name:"描述清晰",value:14},{name:"图文并茂",value:15}]:"reply"===scope.type&&(scope.items=[{name:"社区推荐",value:1},{name:"优秀回复",value:2},{name:"官方采纳",value:3},{name:"专家点评",value:4}])}}}).controller("adoptSelectController",function($scope,adoptSelectService){$scope.modifyButtongStatus=!1,$scope.selectItem=function(option){adoptSelectService.setStatus({statusid:option,tid:$scope.tid,pid:$scope.pid,type:$scope.type,replyid:option}).success(function(respone){var data=respone&&respone.data;data.success&&("reply"==$scope.type?3==option?$scope.agree=2:$scope.replyid=option:$scope.statusid=option)})},$scope.showModifyButton=function(){$scope.modifyButtongStatus=!0},$scope.hideModifyButton=function(){$scope.modifyButtongStatus=!1},$scope.showOpButton=function(){"reply"==$scope.type?($scope.replyid=!1,$scope.agree=!1,$scope.statusid=!1):$scope.statusid=!1}}).service("adoptSelectService",function($http){return{setStatus:function(data){var url="sf.php?mod=adopt&ajaxdata=json";return $http.post(url,data)}}}),angular.module("ui.attachment",["ui.common"]).directive("attachment",function(UI_VIEW_PATH,$timeout,threadData,swfconfigData){function listContainerHtml(id,showimg){var itemId=progressTarget+id;return showimg?'<div class="atta-img-list" id="'+itemId+'_tblheader"><div class="fieldset flash" id="'+itemId+'"></div></div>':'<div class="upfl hasfsl" style="clear:both;"><table cellpadding="0" cellspacing="0" border="0" id="'+itemId+'_tblheader" style="display: none; width: 100%;"><tr><td>点击附件文件名添加到帖子内容中</td><td class="atds">描述</td><td class="attv">阅读权限<img src="./static/image/common/faq.gif" alt="Tip" class="vm" onmouseover="showTip(this)" tip="阅读权限按由高到低排列，高于或等于选中组的用户才可以阅读" /></td><td class="attpr">金钱</td><td class="attc"></td></tr></table><div class="fieldset flash" id="'+itemId+'"></div></div></div>'}function swfConfig(button,id,textareaId){var swfconfig=swfconfigData,fid=threadData.fid;return{upload_url:"misc.php?mod=swfupload&action=swfupload&operation=upload",post_params:{uid:discuz_uid,hash:swfconfig.hash,fid:fid},file_size_limit:swfconfig.max,file_types:swfconfig.attachexts.ext,file_types_description:swfconfig.attachexts.depict,file_upload_limit:swfconfig.limit,file_queue_limit:0,swfupload_preload_handler:preLoad,swfupload_load_failed_handler:loadFailed,file_dialog_start_handler:fileDialogStart,file_queued_handler:fileQueued,file_queue_error_handler:fileQueueError,file_dialog_complete_handler:fileDialogComplete,upload_start_handler:uploadStart,upload_progress_handler:uploadProgress,upload_error_handler:uploadError,upload_success_handler:uploadSuccess,upload_complete_handler:uploadComplete,button_image_url:"/static/image/sf/common/file.jpg",button_placeholder_id:button,button_width:17,button_height:25,button_cursor:SWFUpload.CURSOR.HAND,button_window_mode:"transparent",custom_settings:{progressTarget:progressTarget+id,uploadSource:"forum",uploadType:"attach",uploadFrom:"fastpost",textareaId:textareaId},debug:!1}}var progressTarget="attachList";return{restrict:"A",template:'<label style="width:30px;height:30px;position:relative;"></label>',link:function(scope,elem,attrs){var listContainer=attrs.listContainer||"",textareaId=attrs.textarea||"",pid=attrs.pid||0,showimg=attrs.showimg||!1;return $timeout(function(){angular.element("#"+listContainer).append(listContainerHtml(pid,showimg))}),angular.element(elem).addClass("post-box_file").css("display","inline-block"),elem[0].titile="附件","undefined"==typeof SWFUpload?void showError("upload.js未加载，当前网络可能不稳定"):(angular.element(elem).find("label").attr("id","spanButtonPlaceholder"+pid),void new SWFUpload(swfConfig("spanButtonPlaceholder"+pid,pid,textareaId)))}}}),angular.module("ui.avatar",["ui.common"]).directive("avatar",function(UI_VIEW_PATH,$parse,$http,$timeout,$rootScope,$location){return{restrict:"A",replace:!0,transclude:!0,scope:{watchfollow:"=?"},templateUrl:UI_VIEW_PATH+"/avatar.html?v="+VERHASH,link:function(scope,element,attrs){function getUrlParms(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)"),r=window.location.search.substr(1).match(reg);return null!=r?unescape(r[2]):null}function fetchMemberData(NotCache){return $http({method:"GET",url:"sf.php?mod=member",cache:!NotCache,params:{uid:_data.uid}})}function initData(NotCache){return _state.isLoading=!0,fetchMemberData(NotCache).then(function(respond){var respondData=respond.data.data;return respondData.success&&(_data.member=respondData),respond})["finally"](function(){_state.isLoading=!1})}function popup(){opener||(canceler&&($timeout.cancel(canceler),canceler=null),opener=$timeout(function(){element.find(".popover").length||element.find("div[popover-template]").trigger("click")},100))}function popoff(){canceler||(opener&&($timeout.cancel(opener),opener=null),canceler=$timeout(function(){element.find(".popover").length&&element.find("div[popover-template]").trigger("click"),canceler=null},200))}var _data,_state,canceler,opener,avatarpic,avatarwidgets,noavatarpic;_state=scope.state={isLoading:!1},noavatarpic="true"===attrs.noavatarpic;try{avatarpic=angular.fromJson($parse(attrs.avatarpic)(scope.$parent))||!1}catch(e){avatarpic=$parse(attrs.avatarpic)(scope.$parent)||!1}if(avatarpic||(avatarpic=attrs.avatarpic),avatarwidgets=$parse(attrs.avatarwidgets)(scope.$parent)||!1,_data=scope.data={uid:$parse(attrs.avatar)(scope.$parent),templateUrl:"avatarPopoverTemplate.html",avatarpic:avatarpic,noavatarpic:noavatarpic,avatarwidgets:avatarwidgets,tid:getUrlParms("tid"),host:window.location.pathname,perfect:window.location.href,protocol:window.location.protocol+"//"+window.location.host,member:null},_data.isSelf=_data.uid==discuz_uid,scope.$parent.$watch(attrs.avatar,function(val){_data.uid=val,_data.isSelf=_data.uid==discuz_uid}),attrs.placement?scope.placement=attrs.placement:element.offset().left>document.body.scrollWidth-400?scope.placement="left":scope.placement="right",void 0===_data.uid)throw"user'id should be define before avatar directive init.";$rootScope.$on("avatar_update"+_data.uid,function(e,data){_data.member=data}),element.on("click",".pop-avatar--btn",function(){fetchMemberData(!0).then(function(respond){var respondData=respond.data.data;respondData&&respondData.success&&scope.$emit("avatar_update"+_data.uid,respondData)})}),"true"!==attrs.nopop&&(element.one("mouseover",function(){_data.member||initData(!1)}),element.find(".avatar_content").on("mouseenter",function(){popup()}),element.find(".avatar_content").on("mouseleave",function(){popoff()}),element.on("mouseenter",".popover",function(){popup()}),element.on("mouseleave",".popover",function(){popoff()})),scope.memberChange=function(id,follow){scope.watchfollow=follow}}}}),angular.module("ui.bindMobileBtn",["ui.common"]).directive("bindMobileBtn",function(UI_VIEW_PATH){return{restrict:"A",replace:!0,scope:{num:"=?"},transclude:!0,controller:"BindMobileBtnController",templateUrl:UI_VIEW_PATH+"/bindMobileBtn.html?v="+VERHASH,link:function(scope,element,attrs){scope.type=attrs.type||"link",scope.codetype=attrs.codetype||"reg"}}}).controller("BindMobileBtnController",function($scope,$modal,UI_VIEW_PATH){$scope.open=function($event){$scope.animationsEnabled=!0;var modalInstance=$modal.open({animation:$scope.animationsEnabled,backdrop:"static",templateUrl:UI_VIEW_PATH+"/bindMobileModal.html?v="+VERHASH,controller:function($scope,$modalInstance,bindMobileModalService,data){$scope.data=data,$scope.titleText=angular.element($event.target).text(),$scope.ok=function(){return console.log($scope),$scope.mobile&&/^\d+$/.test($scope.mobile)?$scope.code&&$scope.code.length?void bindMobileModalService.modifyMobile($scope.mobile,$scope.code).success(function(respone){respone.data&&respone.data.success&&($modalInstance.close($scope.mobile),showError(respone.message))}):(showError("请输入验证码"),!1):(showError("手机号码格式不对"),!1)},$scope.cancel=function(){$modalInstance.dismiss()}},size:"md",resolve:{data:function(){return angular.copy({type:$scope.codetype})}}});modalInstance.result.then(function(mobile){$scope.num=mobile})}}).factory("bindMobileModalService",function($http){return{modifyMobile:function(phone,code){return $http.post("home.php?mod=misc&ac=emailcheck&action=modify&inajax=1&handlekey=mobile&ajaxdata=json",{phone:phone,code:code})}}}),angular.module("ui.checkboxField",["ui.common"]).directive("checkboxField",function(UI_VIEW_PATH){return{restrict:"A",replace:!0,transclude:!0,scope:{name:"@",label:"@",value:"@",change:"&",disabled:"@"},templateUrl:UI_VIEW_PATH+"/checkboxField.html?v="+VERHASH,controller:"CheckboxFieldController",link:function(scope,elem){scope.checked=elem.data("checked")||!1,scope.inline=elem.data("inline")||!1}}}).controller("CheckboxFieldController",function($scope){$scope.toggle=function($event){$scope.disabled&&"false"!==$scope.disabled&&"0"!==$scope.disabled||($scope.checked=!$scope.checked),"function"==typeof $scope.change&&"function"==typeof $scope.change()&&$scope.change()($scope.checked)}}),angular.module("ui.comment",[]).directive("comment",function(UI_VIEW_PATH,$timeout,$parse,$http){return{restrict:"A",replace:!0,scope:{data:"=",index:"@",uid:"@",usesig:"@",allowsetting:"@",extcredits2:"@",mobile:"@"},templateUrl:UI_VIEW_PATH+"/comment.html?v="+VERHASH,link:function(scope,$elem,attrs){scope.page=attrs.page||1,scope.updateTextarea=function(callback){var $textarea=$elem.find("textarea");$timeout(function(){$parse($textarea.attr("ng-model")).assign(scope,$textarea.prop("value")),callback&&callback.call(scope,$textarea.prop("value"))})},$elem.on("focus","textarea",function(){scope.updateTextarea()});var editorId="postmessage"+scope.data.pid;smilies_show(editorId+"smiliesdiv",8,editorId),angular.element("#"+editorId+"sml_menu").on("click",function(){scope.updateTextarea()}),scope.deleteAllAttachment=function(){var $=angular.element;$("#attachList"+scope.data.pid+"_tblheader").css("display","none"),$("#attachList"+scope.data.pid).html("")},scope.getAttachmentsOptions=function(){var $elems=$elem.find("[name^=attachnew]"),rs={};return $elems.each(function(i,elem){rs[elem.name]=elem.value}),rs}},controller:function($scope,$sce,commentService,commonService,IMAGES_PATH){var _data,_state;_data=$scope.data,_state=$scope.state={uid:+$scope.uid,index:+$scope.uid,usesig:+$scope.usesig,allowsetting:+$scope.allowsetting,message:"",isRequest:!1,replyFormIsOpen:$scope.data.comments&&!$scope.data.comments.length,replyFormIsFocus:!1,loadImgUrlLg:IMAGES_PATH+"/loading2.gif",noticeauthor:$scope.data.noticeauthor},$scope.reply=function(){$scope.updateTextarea(),_state.isRequest=!0,"function"==typeof parseurl&&(_state.message=parseurl(_state.message));var params=angular.extend({tid:_data.tid,reppid:_data.pid,message:_state.message,usesig:_state.useip,noticeauthor:_state.noticeauthor},$scope.getAttachmentsOptions());params.message=params.message.replace(/([^\w>=\]"'\/@]|^)((www\.)([\w\-]+\.)*[:\.@\-\w\u4e00-\u9fa5]+\.([\.a-zA-Z0-9]+|\u4E2D\u56FD|\u7F51\u7EDC|\u516C\u53F8)((\?|\/|:)+[\w\.\/=\?%\-&;~`@':+!#]*)*)/gi,"$1[url]$2[/url]"),params.message=params.message.replace(/([^>=\]"'\/@]|^)((((https?|ftp|gopher|news|telnet|rtsp|mms|callto|bctp|ed2k|thunder|qqdl|synacast):\/\/))([\w\-]+\.)*[:\.@\-\w\u4e00-\u9fa5]+\.([\.a-zA-Z0-9]+|\u4E2D\u56FD|\u7F51\u7EDC|\u516C\u53F8)((\?|\/|:)+[\w\.\/=\?%\-&;~`@':+!#]*)*)/gi,"$1[url]$2[/url]"),commentService.reply(params).then(function(respond){respond.data.data&&respond.data.data.success?(_data.comments.push(respond.data.data),showCreditPrompt()):showError(respond.data.message),_state.message="",$scope.deleteAllAttachment()})["finally"](function(){_state.isRequest=!1})},$scope.replyTo=function(username){_state.message="回复"+username+"：",$scope.switchReplyForm(!0)},$scope.switchReplyForm=function(state){_state.replyFormIsOpen=void 0===state?!_state.replyFormIsOpen:state,_state.replyFormIsOpen&&(_state.replyFormIsFocus=!0),$scope.fetchNotice()},$scope.showSmiles=function(e){showMenu({ctrlid:e.currentTarget.id,evt:"click",layer:2,pos:"14"})},$scope.fetchNotice=function(){if(!_state.noticeauthor&&_state.uid){var url="forum.php?mod=post&action=reply&fid="+_data.fid+"&tid="+_data.tid+"&repquote="+_data.pid+"&extra=&page="+$scope.page+"&infloat=yes&handlekey=reply&inajax=1&pid="+_data.pid;commentService.fetchNoticeInfo(url).success(function(respone){"object"==typeof respone?_state.noticeauthor=respone.noticeauthor:showError("未知错误，可以通过联系客服人员来解决")})}},$scope.trustAsHtml=function(string){return $sce.trustAsHtml(string)},$scope.setRight=function(pid,tid){$http({method:"GET",url:"forum.php?mod=op&pid="+pid+"&tid="+tid+"&agree=1"}).success(function(data){data.success?commonService.openModal("acceptAnsRet.html","sm"):data.message&&showError(data.message)}).error(function(){showError("通信失败")})},$scope.saveReplyData=function(){saveUserdata("post_"+discuz_uid,_state.message),window.location="forum.php?mod=post&action=reply&fid="+_data.fid+"&tid="+_data.tid+"&repquote="+_data.pid}}}}).directive("focusOn",function($parse,$timeout){var dName="focusOn";return{restrict:"A",link:function(scope,element,attrs){var model=$parse(attrs[dName]);scope.$watch(model,function(val){val===!0&&($timeout(function(){element[0].focus()}),element.bind("blur",function blurTrigger(){scope.$apply(model.assign(scope,!1)),element.off("blur",blurTrigger)}))})}}}),angular.module("ui.creditLevel",["ui.common"]).directive("creditLevel",function(UI_VIEW_PATH,$parse,$http,$timeout,$rootScope){return{restrict:"A",replace:!0,transclude:!0,scope:{},templateUrl:UI_VIEW_PATH+"/creditLevel.html?v="+VERHASH,link:function(scope,element,attrs){function popup(){opener||(canceler&&($timeout.cancel(canceler),canceler=null),opener=$timeout(function(){element.find(".popover").length||element.find("div[popover-template]").trigger("click")},100))}function popoff(){canceler||(opener&&($timeout.cancel(opener),opener=null),canceler=$timeout(function(){element.find(".popover").length&&element.find("div[popover-template]").trigger("click"),canceler=null},200))}var _data,canceler,opener,level;try{level=angular.fromJson($parse(attrs.level)(scope.$parent))}catch(e){level=$parse(attrs.level)(scope.$parent)}if(_data=scope.data={templateUrl:"levelPopoverTemplate.html",level:level},scope.placement=attrs.placement||"right",void 0===_data.level)throw"level'id should be define before level directive init.";element.find(".level_content").on("mouseenter",function(){popup()}),element.find(".level_content").on("mouseleave",function(){popoff()}),element.on("mouseenter",".popover",function(){popup()}),element.on("mouseleave",".popover",function(){popoff()})}}}),angular.module("ui.dateSelet",["ui.common"]).directive("dateSelet",["UI_VIEW_PATH",function(UI_VIEW_PATH){return{restrict:"A",replace:!0,scope:{success:"="},controller:"dateSeletController",templateUrl:UI_VIEW_PATH+"/dateSelet.htm?v="+VERHASH}}]).controller("dateSeletController",function($scope){$scope.startTime="",$scope.endTime="",$scope.nowTime=new Date,$scope.firstTime=new Date,$scope.firstTime.setDate(1),$scope.month=$scope.nowTime.getMonth()+1,$scope.year=$scope.nowTime.getFullYear(),$scope.week=$scope.firstTime.getDate(),$scope.dateSeletBool=!1,$scope.startBool=!0,12==$scope.month?($scope.endmonth=1,$scope.endyear=$scope.year+1):($scope.endmonth=$scope.month+1,$scope.endyear=$scope.year),$scope.endweek=new Date(""+$scope.endyear+"/"+$scope.endmonth+"/1").getDay(),$scope.firstMonthList=[],$scope.endMonthList=[],$scope.seletTime=function(){if($scope.dateSeletBool=!0,$scope.startTime){var startDate=$scope.formatDateList($scope.startTime);$scope.year=startDate[0]-0,$scope.month=startDate[1]-0,$scope.week=new Date(""+$scope.year+"/"+$scope.month+"/1").getDay(),$scope.firstMonthList=$scope.computeDays($scope.year,$scope.month,$scope.week)}if($scope.endTime){var endDate=$scope.formatDateList($scope.endTime);$scope.endyear=endDate[0]-0,$scope.endmonth=endDate[1]-0,$scope.endweek=new Date(""+$scope.endyear+"/"+$scope.endmonth+"/1").getDay(),$scope.endMonthList=$scope.computeDays($scope.endyear,$scope.endmonth,$scope.endweek)}},$scope.monthDays=function(year,month){if(year%4===0){if(2==month)return 28}else if(2==month)return 29;return 1==month?31:3==month?31:4==month?30:5==month?31:6==month?30:7==month?31:8==month?31:9==month?30:10==month?31:11==month?30:31},$scope.blackmonth=function(str,bool){bool||("start"!=str&&str||(1==$scope.month?($scope.month=12,$scope.year=$scope.year-1):$scope.month=$scope.month-1,$scope.week=new Date(""+$scope.year+"/"+$scope.month+"/1").getDay(),$scope.firstMonthList=$scope.computeDays($scope.year,$scope.month,$scope.week)),"end"!=str&&str||(1==$scope.endmonth?($scope.endmonth=12,$scope.endyear=$scope.endyear-1):$scope.endmonth=$scope.endmonth-1,$scope.endweek=new Date(""+$scope.endyear+"/"+$scope.endmonth+"/1").getDay(),$scope.endMonthList=$scope.computeDays($scope.endyear,$scope.endmonth,$scope.endweek)))},$scope.blackyear=function(str,bool){bool||("start"!=str&&str?"end"!=str&&str||($scope.endyear=$scope.endyear-1,$scope.endweek=new Date(""+$scope.endyear+"/"+$scope.endmonth+"/1").getDay(),$scope.endMonthList=$scope.computeDays($scope.endyear,$scope.endmonth,$scope.endweek)):($scope.year=$scope.year-1,$scope.week=new Date(""+$scope.year+"/"+$scope.month+"/1").getDay(),$scope.firstMonthList=$scope.computeDays($scope.year,$scope.month,$scope.week)))},$scope.goyear=function(str,bool){bool||("start"!=str&&str?"end"!=str&&str||($scope.endyear=$scope.endyear+1,$scope.endweek=new Date(""+$scope.endyear+"/"+$scope.endmonth+"/1").getDay(),$scope.endMonthList=$scope.computeDays($scope.endyear,$scope.endmonth,$scope.endweek)):($scope.year=$scope.year+1,$scope.week=new Date(""+$scope.year+"/"+$scope.month+"/1").getDay(),$scope.firstMonthList=$scope.computeDays($scope.year,$scope.month,$scope.week)))},$scope.gomonth=function(str,bool){bool||("start"!=str&&str?"end"!=str&&str||(12==$scope.endmonth?($scope.endmonth=1,$scope.endyear=$scope.endyear+1):$scope.endmonth=$scope.endmonth+1,$scope.endweek=new Date(""+$scope.endyear+"/"+$scope.endmonth+"/1").getDay(),$scope.endMonthList=$scope.computeDays($scope.endyear,$scope.endmonth,$scope.endweek)):(12==$scope.month?($scope.month=1,$scope.year=$scope.year+1):$scope.month=$scope.month+1,$scope.week=new Date(""+$scope.year+"/"+$scope.month+"/1").getDay(),$scope.firstMonthList=$scope.computeDays($scope.year,$scope.month,$scope.week)))},$scope.computeDays=function(year,month,week){for(var list=[],firstMonthdays=$scope.monthDays(year,month),prevdays=$scope.monthDays(year,month-1),i=week-1;i>=0;i--)list.push({bool:!1,num:prevdays-i});for(var i=1;firstMonthdays>=i;i++)list.push({bool:!0,num:i});for(var len=list.length,i=1;42-len>=i;i++)list.push({bool:!1,num:i});return list},$scope.seletDateStart=function(year,month,day,bool){bool&&($scope.startBool?($scope.startTime=year+"-"+(month>=10?month:"0"+month)+"-"+(day>=10?day:"0"+day),$scope.startBool=!1):(new Date($scope.startTime).getTime()>new Date(year+"/"+month+"/"+day)?($scope.endTime=$scope.startTime,$scope.startTime=year+"-"+(month>=10?month:"0"+month)+"-"+(day>=10?day:"0"+day)):$scope.endTime=year+"-"+(month>=10?month:"0"+month)+"-"+(day>=10?day:"0"+day),$scope.startBool=!0,$scope.dateSeletBool=!1),"function"==typeof $scope.success&&$scope.success($scope.startTime,$scope.endTime))},$scope.stopProp=function(){window.event.stopPropagation()},jQuery("body").click(function(){$scope.dateSeletBool=!1}),$scope.formatDate=function(bool){if(bool&&$scope.startTime){var newdate=new Date($scope.startTime);newdate.getFullYear()?!$scope.endTime||new Date($scope.endTime).getTime()>newdate.getTime()?$scope.startTime=newdate.getFullYear()+"-"+(newdate.getMonth()+1>=10?newdate.getMonth+1:"0"+(newdate.getMonth()+1))+"-"+(newdate.getDate()>=10?newdate.getDate():"0"+newdate.getDate()):($scope.startTime=$scope.endTime,$scope.endTime=newdate.getFullYear()+"-"+(newdate.getMonth()+1>=10?newdate.getMonth+1:"0"+(newdate.getMonth()+1))+"-"+(newdate.getDate()>=10?newdate.getDate():"0"+newdate.getDate())):$scope.startTime=""}else if(!bool&&$scope.endTime){var newdate=new Date($scope.endTime);newdate.getFullYear()?!$scope.startTime||new Date($scope.startTime).getTime()<newdate.getTime()?$scope.endTime=newdate.getFullYear()+"-"+(newdate.getMonth()+1>=10?newdate.getMonth+1:"0"+(newdate.getMonth()+1))+"-"+(newdate.getDate()>=10?newdate.getDate():"0"+newdate.getDate()):($scope.endTime=$scope.startTime,$scope.startTime=newdate.getFullYear()+"-"+(newdate.getMonth()+1>=10?newdate.getMonth+1:"0"+(newdate.getMonth()+1))+"-"+(newdate.getDate()>=10?newdate.getDate():"0"+newdate.getDate())):$scope.endTime=""}"function"==typeof $scope.success&&$scope.success($scope.startTime,$scope.endTime)},$scope.formatDateList=function(str){var arr=str.split("-");return arr},$scope.betweenDate=function(year,month,day){var startDate=$scope.formatDateList($scope.startTime),endDate=$scope.formatDateList($scope.endTime);return(startDate[0]<year||startDate[0]==year&&startDate[1]<month||startDate[0]==year&&startDate[1]==month&&startDate[2]<day)&&(endDate[0]>year||endDate[0]==year&&endDate[1]>month||endDate[0]==year&&endDate[1]==month&&endDate[2]>day)?!0:!1},$scope.preselectionDate=function(year,month,day){$scope.startBool||($scope.endTime=year+"-"+(month>=10?month:"0"+month)+"-"+(day>=10?day:"0"+day))},$scope.firstMonthList=$scope.computeDays($scope.year,$scope.month,$scope.week),$scope.endMonthList=$scope.computeDays($scope.endyear,$scope.endmonth,$scope.endweek)}),angular.module("ui.followBtn",["ui.common"]).directive("followBtn",function(UI_VIEW_PATH){return{restrict:"A",replace:!0,scope:{count:"=?",subscribedCount:"=?",id:"@",isfollowed:"@",discuzuid:"=?",change:"=?",watchfollow:"=?"},templateUrl:UI_VIEW_PATH+"/followBtn.html?v="+VERHASH,controller:"FollowBtnController",link:function(scope,element,attrs){scope.type=attrs.type||"forum",scope.questioncount=attrs.questioncount||0,"true"===attrs.followed?scope.followed=!0:"false"===attrs.followed?scope.followed=!1:scope.followed=parseInt(attrs.followed)||0,"forum"===attrs.type&&element.addClass("followForum"),scope.btnText="","subscribe"===scope.type?scope.btnText=scope.followed?"已订阅":"订阅资料":"friend"===scope.type||"forum"===scope.type||"plate"===scope.type||"contenttag"===scope.type?scope.btnText=scope.followed?"已关注":"关注":"thread"===scope.type&&(scope.btnText=scope.followed?"已关注":"关注疑问")}}}).controller("FollowBtnController",function($scope,$rootScope,followBtnService,IMAGES_PATH){function update(){$scope.followed=arguments[0],$scope.loading=arguments[1],$scope.count=arguments[2]||0,$scope.$root.forumCount=arguments[3]||0,$scope.subscribedCount=arguments[4]||0,$scope.questioncount=arguments[5]||0,"subscribe"===$scope.type?$scope.btnText=$scope.followed?"已订阅":"订阅资料":"friend"===$scope.type||"forum"===$scope.type||"plate"===$scope.type||"contenttag"===$scope.type?$scope.btnText=$scope.followed?"已关注":"关注":"thread"===$scope.type&&($scope.btnText=$scope.followed?"已关注":"关注疑问"),"function"==typeof $scope.change&&$scope.change($scope.id,$scope.followed,$scope.watchfollow),$scope.watchfollow=$scope.followed}$scope.loadImgUrl=IMAGES_PATH+"/loading.gif",(0==$scope.isfollowed||1==$scope.isfollowed)&&$scope.$watch("isfollowed",function(){"true"===$scope.isfollowed?$scope.followed=!0:"false"===$scope.isfollowed?$scope.followed=!1:$scope.followed=parseInt($scope.isfollowed)||0,"subscribe"===$scope.type?$scope.btnText=$scope.followed?"已订阅":"订阅资料":"friend"===$scope.type||"forum"===$scope.type||"plate"===$scope.type||"contenttag"===$scope.type?$scope.btnText=$scope.followed?"已关注":"关注":"thread"===$scope.type&&($scope.btnText=$scope.followed?"已关注":"关注疑问")}),$scope.followedBool=!1,$scope.$watch("watchfollow",function(){$scope.followedBool&&($scope.followed=$scope.watchfollow,$scope.btnText=$scope.followed?"已关注":"关注"),$scope.followedBool=!0}),$scope.toggle=function($event){var followed=$scope.followed;if($scope.loading=!0,$scope.id=parseInt($scope.id),$scope.id>0&&("forum"===$scope.type||"friend"===$scope.type||"plate"===$scope.type||"subscribe"===$scope.type||"thread"===$scope.type||"contenttag"===$scope.type)){if(!parseInt(discuz_uid)&&!$scope.discuzuid)return $scope.$root.openQuicklogin($event),void($scope.loading=!1);followed?(mywin=null,followBtnService.remove($scope.id,$scope.type).error(function(){$scope.loading=!1}).success(function(data){data.data.success?update(0,!1,data.data.count,data.data.forumCount,data.data.subscribedCount,data.data.questioncount):$scope.loading=!1})):followBtnService.add($scope.id,$scope.type).error(function(){$scope.loading=!1}).success(function(data){data&&data.data&&data.data.success?data.data.notSubscribed===!0?($scope.loading=!1,window.location.href="sf.php?mod=subscribe&from_fid="+$scope.id):(mywin=null,update(1,!1,data.data.count,data.data.forumCount,data.data.subscribedCount,data.data.questioncount)):$scope.loading=!1})}else showError("操作失败，请刷新页面后再尝试一下")}}).factory("followBtnService",function($http){var url="sf.php?mod=follow&ajaxdata=json";return{add:function(id,type){return $http.post(url,{op:"add",id:id,type:type,formhash:jQuery("#formhash").val()})},remove:function(id,type){return $http.post(url,{op:"remove",id:id,type:type,formhash:jQuery("#formhash").val()})}}}),angular.module("ui.inputTip",["ui.common"]).directive("inputTip",function(UI_VIEW_PATH,$parse,$timeout){return{restrict:"A",replace:!0,transclude:!0,scope:{},templateUrl:UI_VIEW_PATH+"/inputTip.html?v="+VERHASH,link:function(scope,element,attrs){var _data,attr;try{attr=$parse(attrs.inputTip)(scope.$parent)}catch(e){attr=attrs.inputTip}_data=scope.data=attr}}}),angular.module("ui.levelStar",["ui.common"]).directive("levelStar",function(UI_VIEW_PATH){return{restrict:"A",replace:!0,scope:{select:"&"},templateUrl:UI_VIEW_PATH+"/levelStar.html?v="+VERHASH,link:function($scope,elem,attr){$scope.level="",$scope.checked=!1,$scope.name=elem.data("name"),$scope.half=elem.data("half")||!1,$scope.starLight=function(level){$scope.level=level},$scope.starOff=function(){$scope.checked?$scope.level=$scope.checkLevel:$scope.level=0},$scope.starOn=function(level){$scope.level=$scope.checkLevel=level,$scope.checked=!0,"function"==typeof $scope.select&&"function"==typeof $scope.select()&&$scope.select()($scope.name)},$scope.levelWidth=function(){return $scope.half?26*$scope.level+14*parseInt($scope.level-.5):40*$scope.level}}}}),angular.module("ui.medal",["ui.common"]).directive("medal",function(UI_VIEW_PATH,$parse,$http,$timeout,$rootScope){return{restrict:"A",replace:!0,transclude:!0,scope:{},templateUrl:UI_VIEW_PATH+"/medal.html?v="+VERHASH,link:function(scope,element,attrs){function popup(){opener||(canceler&&($timeout.cancel(canceler),canceler=null),opener=$timeout(function(){element.find(".popover").length||element.find("div[popover-template]").trigger("click")},100))}function popoff(){canceler||(opener&&($timeout.cancel(opener),opener=null),canceler=$timeout(function(){element.find(".popover").length&&element.find("div[popover-template]").trigger("click"),canceler=null},200))}var _data,canceler,opener,medal;try{medal=angular.fromJson($parse(attrs.medal)(scope.$parent))}catch(e){medal=$parse(attrs.medal)(scope.$parent)}if(_data=scope.data={templateUrl:"medalPopoverTemplate.html",medal:medal},scope.placement=attrs.placement||"right",void 0===_data.medal)throw"medal'id should be define before medal directive init.";element.find(".medal_content").on("mouseenter",function(){popup()}),element.find(".medal_content").on("mouseleave",function(){
popoff()}),element.on("mouseenter",".popover",function(){popup()}),element.on("mouseleave",".popover",function(){popoff()})}}}),angular.module("ui.mobileCodeBtn",["ui.common"]).directive("mobileCodeBtn",function(UI_VIEW_PATH){return{restrict:"A",replace:!0,scope:{type:"@",mobile:"=?",code:"=?",hascheck:"=?",seccode:"=?",atta:"=?"},templateUrl:UI_VIEW_PATH+"/mobileCodeBtn.html?v="+VERHASH,controller:"MobileCodeBtnController"}}).controller("MobileCodeBtnController",function($scope,commonService,$interval){function decorateTimingText(time){return"重新获取（"+time+"）"}function enableTimeBtn(){$scope.status="init"}function disableTimeBtn(){$scope.status="waiting"}function timing(time){if($scope.status="waiting","string"!=typeof time){var interval=$interval(function(){time=parseInt(time),1>=time?(enableTimeBtn(),$scope.text=decorateTimingText(120),$interval.cancel(interval)):$scope.text=decorateTimingText(--time)},1e3);return interval}$scope.text=time}var interval,_formData,time=120;$scope.text=decorateTimingText(time),$scope.tip={},_formData=$scope.formData={},enableTimeBtn(),$scope.fetchCode=function($event){if("undefined"!=typeof $scope.hascheck&&!$scope.hascheck)return!1;$event.preventDefault(),$event.stopPropagation();var mobile=$scope.mobile||"",atta=$scope.atta||"",checkcode="";if(angular.element('[name="seccodeverify"]').length>0&&!$scope.seccode){var seccodeverify=angular.element('[name="seccodeverify"]').val();if(""==seccodeverify)return void showError("请输入图形验证码");checkcode+="&seccodeverify="+seccodeverify,checkcode+="&seccodehash="+angular.element('[name="seccodehash"]').val(),checkcode+="&seccodemodid="+angular.element('[name="seccodemodid"]').val()}var url="sf.php?mod=code"+checkcode,options={mobile:mobile,code:$scope.code,type:$scope.type,checkcode:checkcode,atta:atta,formhash:angular.element('[name="formhash"]').val()};return disableTimeBtn(),timing("请稍后..."),commonService.fetch(url,options).success(function(data){if(data.data.isreload&&setTimeout(function(){window.location.href="member.php?mod=logging&action=login"},1e3),data.data.success)data.message&&showError(data.message),interval&&$interval.cancel(interval),interval=timing(120);else{var time=data.data.time||!1;data.message?("checkcode_error"!=data.message&&showError(data.message),enableTimeBtn()):time&&(showError(time+"秒前才发过验证码，再等等吧"),$scope.text=decorateTimingText(120-time),interval&&$interval.cancel(interval),interval=timing(120-time))}data.data.hashid&&angular.element("#hashid").val(data.data.hashid),$event.target.parentElement.previousElementSibling.focus()}),!1},$scope.checkCode=function(isnull){var test=/^\d{4,8}$/;return"undefined"==typeof _formData.code||""===_formData.code?isnull||($scope.tip.errors=!0,$scope.tip.tipmsg="请输入验证码"):test.test(_formData.code)?($scope.tip.errors=!1,$scope.tip.tipmsg=!1):($scope.tip.errors=!0,$scope.tip.success=!1,$scope.tip.tipmsg="请输入正确的验证码"),$scope.code=_formData.code,$scope.tip.success}}),angular.module("ui.numberField",["ui.common"]).directive("numberField",function(UI_VIEW_PATH){return{restrict:"AE",replace:!0,scope:{value:"@",name:"@",max:"@",min:"@",num:"=?"},templateUrl:UI_VIEW_PATH+"/numberField.html?v="+VERHASH,controller:"NumberFieldController",link:function(scope,elem){elem.on("keypress",'input[type="text"]',function(e){(e.which<48||e.which>57)&&43!==e.which&&45!==e.which&&e.preventDefault()}),elem.on("change",'input[type="text"]',function(e){+this.value<+scope.min&&(scope.value=scope.min),+this.value>+scope.max&&(scope.value=scope.max),scope.num=scope.value})}}}).controller("NumberFieldController",["$scope",function($scope){$scope.value=parseInt($scope.value,10)||0,$scope.max=void 0===$scope.max?Number.POSITIVE_INFINITY:parseInt($scope.max,10),$scope.min=void 0===$scope.min?Number.NEGATIVE_INFINITY:parseInt($scope.min,10),$scope.minus=function(){isNaN(+$scope.min)||(+$scope.value>+$scope.min&&$scope.value--,$scope.num=$scope.value)},$scope.plus=function(){isNaN(+$scope.max)||(+$scope.value<+$scope.max&&$scope.value++,$scope.num=$scope.value)}}]),angular.module("ui.onlinePop",["ui.common"]).directive("onlinePop",function(UI_VIEW_PATH,$parse,$http,$timeout,$rootScope){return{restrict:"A",replace:!0,transclude:!0,scope:{},templateUrl:UI_VIEW_PATH+"/onlinePop.html?v="+VERHASH,link:function(scope,element,attrs){function popup(){opener||(canceler&&($timeout.cancel(canceler),canceler=null),element.find(".popover").length||element.find("div[popover-template]").trigger("click"))}function popoff(){canceler||(opener&&($timeout.cancel(opener),opener=null),canceler=$timeout(function(){element.find(".popover").length&&element.find("div[popover-template]").trigger("click"),canceler=null},100))}var _data,canceler,opener,onlinePop;try{onlinePop=angular.fromJson($parse(attrs.onlinePop)(scope.$parent))}catch(e){onlinePop=$parse(attrs.onlinePop)(scope.$parent)}if(_data=scope.data={templateUrl:"onlinePopPopoverTemplate.html",onlinePop:onlinePop},scope.placement=attrs.placement||"left",scope.uid=attrs.uid>0?!0:!1,scope.openQuicklogin=$rootScope.openQuicklogin,void 0===_data.onlinePop)throw"onlinePop'id should be define before onlinePop directive init.";element.find(".onlinePop_content").on("mouseenter",function(){popup()}),element.find(".onlinePop_content").on("mouseleave",function(){popoff()}),element.on("mouseenter",".popover",function(){popup()}),element.on("mouseleave",".popover",function(){popoff()})}}}),angular.module("ui.placeholder",["ui.common"]).directive("placeholder",function(){return{restrict:"A",scope:{placeholderColor:"@",placeholderToggle:"@"},link:function(scope,elem,attrs){}}}),angular.module("ui.praiseBtn",["ui.common"]).directive("praiseBtn",function(UI_VIEW_PATH){return{restrict:"A",replace:!0,templateUrl:UI_VIEW_PATH+"/praiseBtn.html?v="+VERHASH,controller:"PraiseBtnController",scope:{pid:"@",authorid:"@",praisecount:"@"},link:function(scope,element,attrs){scope.praised=parseInt(attrs.praised)||0}}}).directive("praiseBtna",function(UI_VIEW_PATH){return{restrict:"A",replace:!0,templateUrl:UI_VIEW_PATH+"/praiseBtna.html?v="+VERHASH,controller:"PraiseBtnControllera",scope:{pid:"@",authorid:"@",praisecount:"@"},link:function(scope,element,attrs){scope.praised=parseInt(attrs.praised)||0}}}).controller("PraiseBtnController",function($scope,$rootScope,commonService){var isRequesing=!1;$scope.praise=function($event){if(isRequesing)return!1;if(!parseInt(discuz_uid))return void $scope.$root.openQuicklogin($event);if(parseInt(discuz_uid)==$scope.authorid)return void showError("不能对自己进行点赞");if($scope.pid>0){if(!$scope.praised){var url="sf.php?mod=praise&ajaxdata=json",option={op:"praise",pid:$scope.pid};isRequesing=!0,commonService.fetch(url,option).success(function(data){isRequesing=!1,data&&data.data&&data.data.success&&($scope.praisecount=data.data.praisecount,$scope.praised=1,jQuery('[data-pid="'+$scope.pid+'"] .praised').removeClass("notpraised").find(".praisecount span").html($scope.praisecount))})}}else showError("操作失败，请刷新页面后再尝试一下")}}).controller("PraiseBtnControllera",function($scope,$rootScope,commonService){var isRequesing=!1;$scope.praise=function($event){if(isRequesing)return!1;if(!parseInt(discuz_uid))return void $scope.$root.openQuicklogin($event);if(parseInt(discuz_uid)==$scope.authorid)return void showError("不能对自己进行点赞");if($scope.pid>0){if(!$scope.praised){var url="sf.php?mod=praise&ajaxdata=json",option={op:"praise",pid:$scope.pid};isRequesing=!0,commonService.fetch(url,option).success(function(data){isRequesing=!1,data&&data.data&&data.data.success&&($scope.praisecount=data.data.praisecount,$event.target.parentElement.parentElement.classList.add("active"),setTimeout(function(){$event.target.parentElement.parentElement.classList.remove("active"),$event.target.parentElement.parentElement.classList.add("active1"),$scope.praised=1},2500))})}}else showError("操作失败，请刷新页面后再尝试一下")}}),angular.module("ui.radioField",["ui.common"]).directive("radioField",function(UI_VIEW_PATH){return{require:"^radioFieldSet",restrict:"A",replace:!0,scope:{label:"@",value:"@"},templateUrl:UI_VIEW_PATH+"/radioField.html?v="+VERHASH,link:function(scope,elem,attr,radioFieldSetCtrl){scope.name=elem.data("name")||radioFieldSetCtrl.name,scope.inline=elem.data("inline")||radioFieldSetCtrl.inline,scope.checked=elem.data("checked")||!1,scope.checked&&radioFieldSetCtrl&&(radioFieldSetCtrl.checkedScope=scope),scope.toggle=function($event){"function"==typeof radioFieldSetCtrl.toggle&&radioFieldSetCtrl.toggle(scope)}}}}),angular.module("ui.radioFieldSet",["ui.common"]).directive("radioFieldSet",function(UI_VIEW_PATH){return{restrict:"A",replace:!0,scope:{name:"@",change:"&"},controller:"RadioFieldSetController"}}).controller("RadioFieldSetController",function($scope,$element){var radioFieldSetCtr=this;this.inline=$element.data("inline"),this.name=$scope.name,this.toggle=function(checkedScope){checkedScope!==radioFieldSetCtr.checkedScope&&(checkedScope.checked=!0,radioFieldSetCtr.checkedScope.checked=!1,radioFieldSetCtr.checkedScope=checkedScope),"function"==typeof $scope.change&&"function"==typeof $scope.change()&&$scope.change()(checkedScope.value)}}),angular.module("ui.rewardBtn",["ui.common"]).directive("rewardBtn",function(UI_VIEW_PATH){return{restrict:"A",templateUrl:UI_VIEW_PATH+"/rewardBtn.html?v="+VERHASH,replace:!0,controller:"RewardBtnController",scope:{rewardsum:"@",extcredits2:"@",author:"@",pid:"@",mobile:"@"},link:function(scope,element,attrs){scope.rewarded=parseInt(attrs.rewarded)||0,scope.authorid=parseInt(attrs.authorid)||0}}}).controller("RewardBtnController",function($scope,$rootScope,$modal,$timeout,commonService,IMAGES_PATH,UI_VIEW_PATH){$scope.moneybagImgUrl=IMAGES_PATH+"/moneybag.png",$scope.reward=function(pid,author,extcredits2,mobile,$event){function setReward(rewardsum){$scope.rewardsum=rewardsum,$scope.rewarded=1}if(!parseInt(discuz_uid))return void $scope.$root.openQuicklogin($event);if(parseInt(discuz_uid)==$scope.authorid)return void showError("不能对自己进行打赏");$modal.open({animation:!0,templateUrl:UI_VIEW_PATH+"/rewardModal.html?v="+VERHASH,size:"md",backdrop:"static",controller:function($scope,$modalInstance){$scope.pid=pid,$scope.author=author,$scope.extcredits2=extcredits2,$scope.mobile=mobile,$scope.close=function(){$modalInstance.close()},$scope.submit=function(){$rootScope.isLoading=!0;var url="sf.php?mod=reward&ajaxdata=json",postData={num:angular.element('input[name="num"]').val(),pid:pid,formhash:jQuery("#formhash").val()};commonService.fetch(url,postData).success(function(data){$rootScope.isLoading=!1,data&&data.data.success&&(jQuery(".reward-panel").length>0&&0==jQuery('.reward-panel .reward_user_img[fromuid="'+discuz_uid+'"]').length&&(4==jQuery(".reward-panel .reward_user_img_link").length&&jQuery(".reward-panel .reward_user_img_link").eq(3).remove(),jQuery(".reward-panel .reward_img").prepend('<a href="home.php?mod=space&uid='+discuz_uid+'&do=profile" class="reward_user_img_link" target="_blank"><img class="img-circle reward_user_img" fromuid="'+discuz_uid+'" src="/uc_server/avatar.php?uid='+discuz_uid+'&size=small" data-bd-imgshare-binded="1"></a>'),jQuery(".reward-panel .reward_user_count").html(data.data.rewarduser+"人已打赏")),setReward(data.data.rewardsum),showError("打赏成功",.5),$timeout(function(){$scope.close()},500))})}}})}}),angular.module("ui.samefeelingBtn",["ui.common"]).directive("samefeelingBtn",function(UI_VIEW_PATH){return{restrict:"A",replace:!0,templateUrl:UI_VIEW_PATH+"/samefeelingBtn.html?v="+VERHASH,controller:"SamefeelingBtnController",link:function(scope,element,attrs){scope.tid=parseInt(attrs.tid)||0,scope.authorid=parseInt(attrs.authorid)||0,scope.count=parseInt(attrs.count)||0,scope.samefeeled=parseInt(attrs.samefeeled)||0,scope.typeid=parseInt(attrs.typeid)||0,13==parseInt(attrs.typeid)?scope.typeText="建议":15==parseInt(attrs.typeid)&&(scope.typeText="资料反馈"),scope.btnText="",scope.btnText=scope.samefeeled?"已顶帖":"我有同感"}}}).controller("SamefeelingBtnController",function($scope,$rootScope,samefeelingBtnService,IMAGES_PATH){function update(){$scope.samefeeled=arguments[0],$scope.loading=arguments[1],$scope.count=arguments[2]||0,$scope.btnText=$scope.samefeeled?"已顶帖":"我有同感"}$scope.loadImgUrl=IMAGES_PATH+"/loading.gif",$scope.samefeeling=function($event){if(!parseInt(discuz_uid))return void $scope.$root.openQuicklogin($event);if(parseInt(discuz_uid)==$scope.authorid)return void showError("不能对自己的帖子做此操作");$scope.loading=!0;var samefeeled=$scope.samefeeled;samefeeled?samefeelingBtnService.remove($scope.tid).error(function(){$scope.loading=!1}).success(function(data){data&&data.data.success?update(0,!1,data.data.count):$scope.loading=!1}):samefeelingBtnService.add($scope.tid).error(function(){$scope.loading=!1}).success(function(data){data&&data.data.success?update(1,!1,data.data.count):$scope.loading=!1})}}).factory("samefeelingBtnService",function($http){var url="sf.php?mod=samefeeling&ajaxdata=json";return{add:function(tid){return $http.post(url,{op:"add",tid:tid})},remove:function(tid){return $http.post(url,{op:"remove",tid:tid})}}}),angular.module("ui.searchBar",["ui.common"]).directive("searchBar",["UI_VIEW_PATH",function(UI_VIEW_PATH){return{restrict:"A",replace:!0,scope:{keyword:"=?",search:"&",pldtext:"=?"},controller:"SearchBarController",templateUrl:UI_VIEW_PATH+"/searchBar.html?v="+VERHASH}}]).controller("SearchBarController",["$scope",function($scope){$scope.searchEvent=function($event){"function"==typeof $scope.search&&($event&&13===$event.keyCode||!$event)&&$scope.search()($scope.keyword)}}]),angular.module("ui.selectField",["ui.common"]).directive("selectField",["UI_VIEW_PATH",function(UI_VIEW_PATH){return{restrict:"A",replace:!0,transclude:!0,templateUrl:UI_VIEW_PATH+"/selectField.html?v="+VERHASH,scope:{display:"@",value:"@",name:"@",label:"@",elem:"@",addclass:"@",change:"&"},compile:function(elem,attrs,transcludeFn){return function(scope,elem){scope.value=scope.value||0,selElem=scope.elem||"li";var items=elem.contents("[ng-transclude]").find(selElem);items.each(function(index,item){var $item=angular.element(item),itemValue=$item.data("value")||"";1===item.nodeType&&scope.value==itemValue&&(scope.display=scope.display||$item.text(),scope.addclass&&$item.addClass("isactive"))}),elem.on("click",".dropdown-menu "+selElem,function(){var $self=angular.element(this);scope.value=$self.data("value"),scope.display=$self.text(),scope.$apply(),"function"==typeof scope.change&&"function"==typeof scope.change()&&scope.change()(scope.value)}),elem.removeClass("ng-hide")}}}}]),angular.module("ui.sfPager",["ui.common"]).directive("sfPager",function(UI_VIEW_PATH,$parse){return{restrict:"EA",replace:!0,templateUrl:UI_VIEW_PATH+"/pager.html?v="+VERHASH,scope:{count:"=",current:"=",per:"=?",maxlen:"=?",range:"=?",change:"&"},link:function(scope,element,attrs){scope.goTop=function(){angular.element(document).scrollTop(0)},scope.isScrollTop=$parse(attrs.scrollTop)(scope.$parent)},controller:function($scope){function getPageArr(count,cPage,maxLen,range){maxLen=maxLen||10,range=range||4;var i,num,result=[],isFore=maxLen>cPage,isBack=cPage>count-maxLen+1;if(isFore)for(i=0;count>i;i++)num=i+1,(maxLen>=num||num===count)&&result.push(num);else if(isBack)for(i=0;count>i;i++)num=i+1,(maxLen>count-num||1===num)&&result.push(num);else for(i=0;count>i;i++)num=i+1,(1===num||num===count||Math.abs(num-cPage)<=range)&&result.push(num);return result}$scope.isScrollTop=void 0===$scope.isScrollTop||$scope.isScrollTop,$scope.state={isScrollTop:!0,pageArr:null,pageCount:null,inputValue:0},$scope.$watch("current",function(newVal,oldVal,scope){void 0===newVal&&angular.equals(newVal,oldVal)||(scope.state.inputValue=newVal)}),$scope.$watch("count",function(newVal,oldVal,scope){void 0===newVal&&angular.equals(newVal,oldVal)||(scope.state.pageCount=Math.ceil(+scope.count/+scope.per))}),$scope.$watch(function(){return[$scope.current,$scope.count]},function(newVal,oldVal,scope){(void 0!==$scope.current&&void 0!==$scope.count||!angular.equals(newVal,oldVal))&&(scope.state.pageArr=getPageArr(scope.state.pageCount,+scope.current,scope.maxlen,scope.range),scope.isScrollTop&&scope.goTop())},!0),$scope.setPage=function(num){angular.element(window).scrollTop(0),num=isFinite(num)?+num:1,$scope.current=num>$scope.state.pageCount?$scope.state.pageCount:1>num?1:num,"function"==typeof $scope.change&&"function"==typeof $scope.change()&&$scope.change()($scope.current)},$scope.pre=function(){$scope.setPage(+$scope.current-1)},$scope.next=function(){$scope.setPage(+$scope.current+1)}}}}),angular.module("ui.tabsHover",["ui.common"]).directive("tabsHover",["$timeout",function($timeout){return{restrict:"A",link:function(scope,$elem,attrs){$timeout(function(){var jq=angular.element,$activeElem=$elem.find(".active"),$hoverElem=$activeElem.clone(),$hoverElemChildren=$hoverElem.children();$elem.css({position:"relative"});var activeElemPosition=$activeElem.position(),activeElemLeft=activeElemPosition.left;$hoverElem.css({position:"absolute",left:activeElemLeft,top:activeElemPosition.top,zIndex:0,transition:"left .3s"}),$hoverElemChildren.html("<span>"+$hoverElemChildren.text()+"</span>"),$hoverElemChildren.children().css({opacity:0}),$elem.children().find(">a").on("click",function(){"_blank"!=jq(this).attr("target")&&($activeElem=jq(this).parent(),activeElemPosition=$activeElem.position(),activeElemLeft=activeElemPosition.left)}).parent().css("zIndex",1).hover(function(){$hoverElem.css({left:jq(this).position().left}),$activeElem.removeClass("active"),$hoverElemChildren.find("span").text(jq(this).text())},function(){$hoverElem.css({left:activeElemLeft}),$hoverElemChildren.find("span").text($activeElem.text()),$activeElem.addClass("active")}),$elem.append($hoverElem)},0)}}}]),angular.module("ui.vipGroup",["ui.common"]).directive("vipGroup",function(UI_VIEW_PATH,$timeout){return{restrict:"A",replace:!1,templateUrl:UI_VIEW_PATH+"/vipGroup.html?v="+VERHASH,controller:"VipGroupController",scope:{authorid:"@",groupid:"@"},link:function(scope,element,attrs){function popup(){opener||(canceler&&($timeout.cancel(canceler),canceler=null),opener=$timeout(function(){element.find(".popover").length||element.find("div[popover-template]").trigger("click")},100))}function popoff(){canceler||(opener&&($timeout.cancel(opener),opener=null),canceler=$timeout(function(){element.find(".popover").length&&element.find("div[popover-template]").trigger("click"),canceler=null},200))}var _data,canceler,opener;_data=scope.data={templateUrl:"vipPopoverTemplate.html"},scope.placement=attrs.placement||"right",element.find(".vipuser").on("mouseenter",function(){popup()}),element.find(".vipuser").on("mouseleave",function(){popoff()}),element.on("mouseenter",".popover",function(){popup()}),element.on("mouseleave",".popover",function(){popoff()})}}}).controller("VipGroupController",function($scope,$rootScope,vipGroupService){0==$scope.groupid&&vipGroupService.isvip($scope.authorid).success(function(data){$scope.groupid=data.data.groupid})}).factory("vipGroupService",function($http){var url="sf.php?mod=api&ajaxdata=json";return{isvip:function(authorid){return $http.post(url,{action:"vip",authorid:authorid})}}});