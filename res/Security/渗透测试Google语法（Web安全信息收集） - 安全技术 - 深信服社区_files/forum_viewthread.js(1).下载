/*! sangforbbs 2020-11-26 */
"use strict";!function($){var initReplyEvent=function(){$("#reply-btn,#reply-btn1").on("click",function(e){var $inputArea=$("#fastpostmessage");$inputArea.length||($inputArea=$("#fastposteditor")),$(window).scrollTop($inputArea.offset().top-100),$inputArea.focus(),e.preventDefault()}),$("#fastpostmessage").bindHashEvent({on:null,callback:function(id){id===this.id&&setTimeout(function(){$("#reply-btn").trigger("click")},500)}})},initFavoriteOperation=function(){var $favoriteButton=$("#k_favorite"),$favoriteNumber=$("#favoritenumber"),$favoriteIcon=$("#favorite-icon");$favoriteButton.bindAjaxRequest({url:"forum.php?mod=viewthread&inajax=1&get=favtimes&tid="+$favoriteButton.data("tid"),datatype:"text",success:function(data,status,jqXHR,elem){$favoriteNumber.html(data)}}),$favoriteButton.bindAjaxRequest({url:function(){return this.href},success:function(data,status,jqXHR,elem){var oldUrl,that=$(elem);(data.data.length||data.data)&&($favoriteIcon.toggleClass("is-active"),oldUrl=that.prop("href"),that.prop("href",that.data("href")),that.data("href",oldUrl)),showError(data.message)}})},initEditTypeStatusOperation=function(){var $typeStatus=$(".nav .type-status");$typeStatus.hover(function(){$(this).addClass("type-status-hover")},function(){$(this).removeClass("type-status-hover")}).on("click",".status-edit",function(e){e.preventDefault(),$("#typeStatusDropdown").show(),$typeStatus.hide()}),$.bindAjaxRequest($(".op"),{callback:function(){return $(this).hasClass("a")?($("#typeStatusDropdown").hide(),$typeStatus.show(),!1):void 0},url:function(){return $(this).attr("data-href")},success:function(data){data.success?window.location.reload():data.message&&showError(data.message)}})};$(function(){$.ajaxSetup({cache:!1}),$.bindAjaxRequest($(".followForum"),{url:function(){return $(this).attr("data-href")},success:function(data,status,jqXHR,elem){var $elem=$(elem);$elem.attr("data-href",data.url),data.state?($elem.html("取消关注"),$elem.addClass("is-active")):($elem.html("关注"),$elem.removeClass("is-active"))}}),$(document).bindHashEvent({on:null,prefix:"",callbackName:"jump_to_post",callback:function(id){var $post,$firstpost;"/lastpost"===id?$post=$("[name=lastpost]"):"/firstpost"===id?($firstpost=$("#postlist").children("div[id^='post_']").first(),$firstpost&&$firstpost.length&&$(document).scrollTop($firstpost.height()+100)):/^pid\d+$/g.test(id)&&($post=$("#"+id)),$post&&$post.length&&$(document).scrollTop($post.offset().top)}}),initReplyEvent(),initEditTypeStatusOperation(),initFavoriteOperation()})}(jQuery,window);